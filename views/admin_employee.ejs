<!DOCTYPE html>
<html lang="en">



<head>
    <%- include('partials/head.ejs') %>
        <link rel="stylesheet" type="text/css" href="/css/vendors/daterange-picker.css">

</head>

<body>
    <%- include('partials/sidebar.ejs') %>`
        <div class="page-body">
            <div class="container-fluid">
                <div class="page-title">
                    <div class="row">
                        <div class="col-sm-6">
                            <h3>Employee List</h3>
                        </div>
                        <div class="col-sm-6">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="/admin/dashboard"><i data-feather="home"
                                            class="me-2"></i>Dashboard</a></li>
                                <li class="breadcrumb-item active"><a href="/admin/attendance"><i
                                            data-feather="user-check" class="me-2"></i>Attendance List</a></li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid ">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="mt-3">
                            <div class="card">
                                <div class="card-body d-flex align-items-center justify-content-end flex-wrap gap-2">


                                    <!-- <div class="dropdown">
                                        <button class="btn btn-square btn-outline-primary dropdown-toggle" type="button"
                                            data-bs-toggle="dropdown" aria-expanded="false">
                                           <i class="fa-duotone fa-solid fa-user me-1"></i> Chandresh Bhil
                                        </button>
                                          
                                    </div> -->


                                    <div>
                                        <div class="theme-form">
                                            <div>
                                                <input class="form-control text-primary border-primary" type="text"
                                                    oninput="Datapic()" onchange="Datapic()" name="birthdate"
                                                    id="datePic" value="4/24/2023">
                                            </div>
                                        </div>
                                    </div>


                                    <button class="btn btn-outline-dark rounded"
                                        style="font-size: 16px; padding: 0px !important; height: 35px; width:35px ;">
                                        <i class="fa-regular fa-arrow-down-to-line"></i>
                                    </button>


                                    <button class="btn btn-square btn-primary rounded-circle text-white"
                                        style="font-size: 20px; padding: 0px !important; height: 35px; width:35px ;">
                                        +
                                    </button>

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- HTML (DOM) sourced data  Starts-->
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="table-responsive theme-scrollbar">
                                    <table class="display" style="font-size: 12px;" id="basic-1">
                                        <thead>
                                            <tr>
                                                <th class="d-none">#</th>
                                                <th>Date</th>
                                                <th>Employee</th>

                                                <th>Day</th>
                                                <th>Attendance</th>
                                                <th>Clock In</th>
                                                <th>Clock Out</th>
                                                <th>Total Time</th>
                                                <th>Break Time</th>
                                                <th>Work Time</th>
                                                <th>Extra Time</th>
                                                <th>Clockin IP</th>
                                                <th>Clockout IP</th>
                                                <th>Action</th>
                                            </tr>

                                        </thead>
                                        <tbody id="tbody">
                                            <% employeeList.map((val,i)=>{%>
                                                <% const [day, month, year]=val.date.split('-'); const dateObj=new
                                                    Date(`${year}-${month}-${day}`); const
                                                    weekday=dateObj.toLocaleDateString('en-US', { weekday: 'short' });
                                                    const monthName=dateObj.toLocaleDateString('en-US', { month: 'short'
                                                    }); const formattedDate=`${weekday}, ${String(day).padStart(2, '0'
                                                    )} ${monthName}, ${year}`; %>
                                                    <tr class="odd">
                                                        <td class="d-none">
                                                            <%=i++%>
                                                        </td>
                                                        <td>
                                                            <%=formattedDate%>
                                                        </td>
                                                        <td>
                                                            <a href="/admin/attendlist/<%=val.emplyeeId%>">
                                                                <%=val.em_name%>
                                                            </a>
                                                        </td>

                                                        <td>
                                                            <% if(val.day_status==='FD' ){ %>
                                                                <div class="d-flex align-items-center justify-content-center px-2 py-1 rounded text-success fw-semibold"
                                                                    style="width: 40px; height: 28px; background-color: rgba(25, 135, 84, 0.1);">
                                                                    FD
                                                                </div>
                                                                <% } else { %>
                                                                    <div class="d-flex align-items-center justify-content-center px-2 py-1 rounded text-info fw-semibold"
                                                                        style="width: 40px; height: 28px; background-color: rgba(13, 202, 240, 0.1); ">
                                                                        WK
                                                                    </div>
                                                                    <% } %>
                                                        </td>
                                                        <td>
                                                            
                                                            <% const today=new Date(); const
                                                                dayDate=String(today.getDate()).padStart(2, '0' ); const
                                                                monthDate=String(today.getMonth() + 1).padStart(2, '0'
                                                                ); const yearDate=today.getFullYear(); const
                                                                formattedDate2=`${dayDate}-${monthDate}-${yearDate}`;%>
                                                                <% if(val.clockOut_time==='' ) {%>

                                                                    <div
                                                                        class="d-flex align-items-center justify-content-center px-2 py-1 rounded text-primary fw-semibold"
                                                                        style="width: 20px; height: 20px; background-color: rgba(25, 76, 135, 0.1); font-size: 12px;">
                                                                        <i class="fa-solid fa-triangle-exclamation" data-bs-toggle="tooltip" data-bs-placement="Top" title="On Going!"></i>
                                                                    </div>
                                                                    <!-- <i class="bg-light-success font-success" data-feather="alert-triangle"></i> -->
                                                                    <% }else if(val.attendens_status==='P' ) { %>
                                                                        <div
                                                                            class="d-flex align-items-center justify-content-center px-2 py-1 rounded text-success fw-semibold"
                                                                            style="width: 20px; height: 20px; background-color: rgba(25, 135, 84, 0.1); font-size: 12px;" data-bs-toggle="tooltip" data-bs-placement="Top" title="Present">
                                                                            P
                                                                        </div>
                                                                        <% } else { %>
                                                                            <div
                                                                                class="d-flex align-items-center justify-content-center px-2 py-1 rounded text-danger fw-semibold"
                                                                                style="width: 20px; height: 20px; background-color: rgba(220, 53, 69, 0.1); font-size: 12px;"
                                                                                 data-bs-toggle="tooltip" data-bs-placement="Top" title="Absent"
                                                                                >
                                                                                A
                                                                            </div>
                                                                            <% } %>
                                                        </td>
                                                        <% function SecondTime(t) { if (val.attendens_status==='P' && t
                                                            !=='-' ) { if (!t || typeof t !=='string' ) { return '00:00'
                                                            ; } const [h, m]=t.split(':'); const ampm=t.includes('AM')
                                                            ? 'AM' : 'PM' ; return `${h.padStart(2, '0'
                                                            )}:${m.padStart(2, '0' )} ${ampm}`; }else{ return '-' ; } }
                                                            %>
                                                            <td>
                                                                <%=SecondTime(val.clockIn_time)%>
                                                            </td>
                                                            <td>
                                                                <%=SecondTime(val.clockOut_time)%>
                                                            </td>
                                                            <% function formatTime(t) { if (val.attendens_status==='P'
                                                                && t !=='-' ) { if (!t || typeof t !=='string' ) {
                                                                return '00:00' ; } const parts=t.split(':').map(part=>
                                                                part.padStart(2,
                                                                '0'));
                                                                while (parts.length < 2) parts.unshift('00'); return
                                                                    parts.slice(0, 2).join(':'); } else { return '-' ; }
                                                                    } %>
                                                                    <td>
                                                                        <%=formatTime(val.total_time)%>
                                                                    </td>

                                                                    <td>
                                                                        <%= formatTime(val.break_time) %>
                                                                    </td>
                                                                    <td>
                                                                        <%= formatTime(val.productive_time) %>
                                                                    </td>
                                                                    <td>
                                                                        <%= formatTime(val.extra_time) %>
                                                                    </td>
                                                                    <td>
                                                                        <%=val.clockIn_ip%>
                                                                    </td>
                                                                    <td>
                                                                        <%=val.clockOut_ip%>
                                                                    </td>
                                                                    <td>
                                                                        <%if(val.attendens_status==='P' ){%>
                                                                            <ul class="action">
                                                                                <li class="edit"><a
                                                                                        href="/employee/entry/<%=val.id%>"
                                                                                        data-bs-original-title=""
                                                                                        title="">
                                                                                        <i
                                                                                            class="fa-light fa-eye me-2 text-primary"></i></a>
                                                                                </li>
                                                                            </ul>
                                                                            <%}else{%>
                                                                                <ul class="action">
                                                                                    <span>-</span>
                                                                                </ul>
                                                                                <%}%>
                                                                    </td>
                                                    </tr>
                                                    <%})%>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- HTML (DOM) sourced data  Ends-->
                    </div>
                    <!-- Container-fluid Ends-->
                </div>
            </div>
        </div>


        <%- include('partials/footer.ejs') %>
            <%- include('partials/script.ejs') %>


                <script src="/js/datepicker/daterange-picker/moment.min.js"></script>
                <script src="/js/datepicker/daterange-picker/daterangepicker.js"></script>
                <script src="/js/datepicker/daterange-picker/daterange-picker.custom.js"></script>
                <script src="/js/tooltip-init.js"></script>


                <script>
                    const today = new Date();
                    const formatDate = (date) => {
                        const day = String(date.getDate()).padStart(2, '0');
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const year = date.getFullYear();
                        return `${month}/${day}/${year}`;
                    };

                    document.querySelector('input[name="birthdate"]').value =
                        `${formatDate(today)}`;


                    function Datapic() {

                        function convertDateFormat(dateStr) {
                            const [month, day, year] = dateStr.split('/');
                            return `${day}-${month}-${year}`;
                        }


                        let datePic = document.getElementById('datePic').value
                        let findDate = convertDateFormat(datePic)


                        $.ajax({
                            url: '/admin/attendDate',
                            method: 'POST',
                            data: { date: findDate },
                            success: function (res) {
                                const tbody = document.getElementById("tbody");
                                tbody.innerHTML = "";



                                res.forEach((val, i) => {

                                    function formatTime(t) {
                                        if (val.attendens_status === 'P' && t !== '-') {
                                            if (!t || typeof t !== 'string') {
                                                return '00:00';
                                            }
                                            const parts = t.split(':').map(part => part.padStart(2, '0'));
                                            while (parts.length < 2) parts.unshift('00');
                                            return parts.slice(0, 2).join(':');
                                        } else {
                                            return '-';
                                        }
                                    }

                                    function SecondTime(t) {
                                        if (val.attendens_status === 'P' && t !== '-') {
                                            if (!t || typeof t !== 'string') {
                                                return '00:00';
                                            }
                                            const [h, m] = t.split(':');
                                            const ampm = t.includes('AM') ? 'AM' : 'PM';
                                            return `${h.padStart(2, '0')}:${m.padStart(2, '0')} ${ampm}`;
                                        } else {
                                            return '-';
                                        }
                                    }

                                    const [day, month, year] = val.date.split('-');
                                    const dateObj = new Date(`${year}-${month}-${day}`);
                                    const weekday = dateObj.toLocaleDateString('en-US', { weekday: 'short' });
                                    const monthName = dateObj.toLocaleDateString('en-US', { month: 'short' });
                                    const formattedDate = `${weekday}, ${String(day).padStart(2, '0')} ${monthName}, ${year}`;

                                    const statusDiv = val.day_status === 'FD' ? `
            <div class="d-flex align-items-center justify-content-center px-2 py-1 rounded text-success fw-semibold"
                style="width: 40px; height: 28px; background-color: rgba(25, 135, 84, 0.1);">FD
            </div>
        ` : `
            <div class="d-flex align-items-center justify-content-center px-2 py-1 rounded text-info fw-semibold"
                style="width: 40px; height: 28px; background-color: rgba(13, 202, 240, 0.1);">WK
            </div>
        `;

                                    const attendanceIcon = val.clockOut_time === '' ? `
                 <div
                     class="d-flex align-items-center justify-content-center px-2 py-1 rounded text-primary fw-semibold"
                     style="width: 20px; height: 20px; background-color: rgba(25, 76, 135, 0.1); font-size: 12px;"
                     data-bs-toggle="tooltip" data-bs-placement="top"
                     title="On Going!" >
                     <i class="fa-solid fa-triangle-exclamation"></i>
                    </div>
        ` : val.attendens_status === 'P' ? `
             <div
                 class="d-flex align-items-center justify-content-center px-2 py-1 rounded text-success fw-semibold"
                 style="width: 20px; height: 20px; background-color: rgba(25, 135, 84, 0.1); font-size: 12px;"
                 data-bs-toggle="tooltip"
                 data-bs-placement="top"
                title="Present"
                 >
                 P
              </div>
        ` : `
             <div
                 class="d-flex align-items-center justify-content-center px-2 py-1 rounded text-danger fw-semibold"
                 style="width: 20px; height: 20px; background-color: rgba(220, 53, 69, 0.1); font-size: 12px;"
                 data-bs-toggle="tooltip"
                 data-bs-placement="top"
                  title="Absent"
                 >
                 A
               </div>
        `;

                                    const actionLink = val.attendens_status === 'P' ? `
            <ul class="action">
                <li class="edit">
                    <a href="/employee/entry/${val.id}" title="">
                        <i class="fa-light fa-eye me-2 text-primary"></i>
                    </a>
                </li>
            </ul>
        ` : `
            <ul class="action">
                <span>-</span>
            </ul>
        `;

                                    tbody.innerHTML += `
            <tr class="odd">
                <td class="d-none">${i + 1}</td>
                <td>${formattedDate}</td>
                <td>
                    <a href="/admin/attendlist/${val.emplyeeId}" class="text-black">${val.em_name}</a>
                </td>
                <td>${statusDiv}</td>
                <td>${attendanceIcon}</td>
                <td>${SecondTime(val.clockIn_time) || '-'}</td>
                <td>${SecondTime(val.clockOut_time) || '-'}</td>
                <td>${formatTime(val.total_time) || '-'}</td>
                <td>${formatTime(val.break_time) || '-'}</td>
                <td>${formatTime(val.productive_time) || '-'}</td>
                <td>${formatTime(val.extra_time) || '-'}</td>
                <td>${val.clockIn_ip || '-'}</td>
                <td>${val.clockOut_ip || '-'}</td>
                <td>${actionLink}</td>
            </tr>
        `;
                                });
                                $('[data-bs-toggle="tooltip"]').tooltip();
                            }

                        })

                    }
                </script>


</body>




</html>